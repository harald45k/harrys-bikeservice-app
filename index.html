<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Harry's Bikeservice</title>
  <style>
    :root { --orange:#D55C28; --dark:#2E4A2F; --light:#6B8F4E; --beige:#F7F2E6; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--beige);color:var(--dark)}
    header{position:sticky;top:0;z-index:10;background:var(--dark);color:var(--orange);padding:14px 16px;display:flex;align-items:center;gap:12px;box-shadow:0 2px 10px rgba(0,0,0,.15)}
    header .dot{width:40px;height:40px;border-radius:8px;background:var(--orange);display:inline-block}
    .container{max-width:900px;margin:0 auto;padding:16px}
    .tabs{position:sticky;bottom:0;z-index:10;display:grid;grid-template-columns:repeat(6,1fr);background:var(--dark);gap:6px;padding:6px;box-shadow:0 -2px 10px rgba(0,0,0,.15)}
    .tab-btn{background:transparent;border:none;color:#fff;padding:10px 6px;border-radius:12px;font-weight:600;cursor:pointer}
    .tab-btn.active{background:var(--light)}
    .card{background:#fff;border-radius:18px;margin-bottom:14px;border:1px solid rgba(0,0,0,.06);box-shadow:0 6px 20px rgba(0,0,0,.08);overflow:hidden}
    .inner{padding:14px}
    h3{margin:0 0 6px;color:var(--dark)}
    .badge{display:inline-block;background:var(--orange);color:#fff;padding:4px 10px;border-radius:999px;font-size:12px;margin-bottom:8px}
    .btn{display:inline-block;background:var(--orange);color:#fff;border:none;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.secondary{background:var(--light)}
    .label{font-size:13px;color:#3a3a3a;margin:8px 0 4px;display:block}
    input,select,textarea{width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:12px;background:#fff}
    .section-title{font-weight:800;color:var(--dark);margin:16px 0 10px;font-size:18px}
    .small{font-size:12px;color:#555}
    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
    .box{background:#fff;border-radius:14px;padding:10px;text-align:center;border:1px solid rgba(0,0,0,.06)}
    .row{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border:1px solid #eee;border-radius:12px;background:#fff}
    a{color:var(--orange);text-decoration:none}
  </style>
</head>
<body>
  <header>
    <span class="dot"></span>
    <h1>Harry's Bikeservice</h1>
  </header>

  <div class="container">
    <div id="content"></div>
  </div>

  <footer>
    <nav class="tabs">
      <button class="tab-btn active" data-tab="start">Start</button>
      <button class="tab-btn" data-tab="termin">Termin</button>
      <button class="tab-btn" data-tab="status">Status</button>
      <button class="tab-btn" data-tab="bonus">Bonus</button>
      <button class="tab-btn" data-tab="kontakt">Kontakt</button>
      <button class="tab-btn" data-tab="admin">Admin</button>
    </nav>
  </footer>

  <script>
    // ================== EINSTELLUNGEN ==================
    // Trage hier später DEINE Google Apps Script Web-App URL (endet mit /exec) ein:
    const APPSCRIPT_BASE = ""; // z.B. "https://script.google.com/macros/s/AKfycb.../exec"
    // Admin-PIN für den Admin-Tab:
    const ADMIN_PIN = "1234";  // ändere das auf deinen Wunsch-PIN

    // ================== INHALTE ==================
    const DATA = {
      news: [
        { id: 1, title: "Frühlingsservice – spare 15% bis 30. April", teaser: "Jetzt Termin sichern – Plätze begrenzt!", category: "Aktion", body: "Komplett-Check, Brems-/Schaltungs-Setup, Kettenpflege. Ideal für den Saisonstart." },
        { id: 2, title: "Tipp: Kette richtig pflegen", teaser: "So hält sie länger und läuft leiser.", category: "Tipp", body: "Reinigen → Trocknen → Schmieren. Danach kurz einwirken lassen." }
      ],
      services: [
        { id: "S-100", name: "Kleiner Service", price: 59 },
        { id: "S-200", name: "Großer Service", price: 109 },
        { id: "S-300", name: "Bremsservice", price: 39 },
        { id: "S-400", name: "E-Bike-Check", price: 69 }
      ],
      contact: {
        phone: "+43 660 6809867",
        whatsapp: "https://wa.me/436606809867",
        maps: "https://maps.app.goo.gl/FsAwkyb9EeGZToCx9",
        email: "harald.79@gmx.at",
        address: "Ausserfeldstraße 58, 6706 Bürs"
      }
    };

    const content = document.getElementById('content');

    // ================== START ==================
    function renderStart() {
      let html = `
        <div class="kpi">
          <div class="box"><div class="small">Aktionen aktiv</div><div><strong>${DATA.news.length}</strong></div></div>
          <div class="box"><div class="small">Services</div><div><strong>${DATA.services.length}</strong></div></div>
          <div class="box"><div class="small">Online</div><div><strong>✅</strong></div></div>
        </div>`;
      DATA.news.forEach(n => {
        html += `
        <div class="card"><div class="inner">
          <span class="badge">${n.category}</span>
          <h3>${n.title}</h3>
          <p>${n.teaser}</p>
          <button class="btn" onclick="alert('Mehr lesen: ${n.title}\\n\\n${n.body}')">Mehr lesen</button>
        </div></div>`;
      });
      content.innerHTML = html;
    }

    // ================== TERMIN ==================
    function renderTermin() {
      content.innerHTML = `
      <div class="card"><div class="inner">
        <div class="section-title">Termin buchen</div>
        <label class="label">Name</label><input id="t_name" placeholder="Dein Name" />
        <label class="label">Telefon</label><input id="t_tel" placeholder="+43 ..." />
        <label class="label">E-Mail</label><input id="t_mail" placeholder="dein@mail.at" />
        <label class="label">Service</label>
        <select id="t_service">
          ${DATA.services.map(s => `<option value="${s.id}">${s.name} (ab €${s.price})</option>`).join("")}
        </select>
        <label class="label">Wunschtermin</label><input id="t_date" type="date" />
        <label class="label">Hinweis</label><textarea id="t_note" rows="3" placeholder="Was sollen wir wissen?"></textarea>
        <div style="margin-top:12px"><button class="btn" onclick="submitTermin()">Anfrage senden</button></div>
        <div class="small" style="margin-top:8px">Demo: Speicherung erst aktiv, wenn <code>APPSCRIPT_BASE</code> gesetzt ist.</div>
      </div></div>`;
    }

    async function submitTermin() {
      const payload = {
        name: document.getElementById('t_name').value.trim(),
        tel: document.getElementById('t_tel').value.trim(),
        mail: document.getElementById('t_mail').value.trim(),
        service: document.getElementById('t_service').value,
        date: document.getElementById('t_date').value,
        note: document.getElementById('t_note').value.trim(),
        created_at: new Date().toISOString()
      };
      if (!payload.name || !payload.tel || !payload.date) { alert('Bitte Name, Telefon und Datum ausfüllen.'); return; }
      if (!APPSCRIPT_BASE) { alert('Demo: Keine Speicherung, weil APPSCRIPT_BASE leer ist.'); return; }
      try {
        const r = await fetch(APPSCRIPT_BASE + '?action=createAppointment', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
        const data = await r.json();
        if (data.ok) alert('Danke! Anfrage gespeichert.'); else throw new Error(data.error||'Fehler');
      } catch(e){ alert('Fehler beim Senden: ' + e.message); }
    }

    // ================== STATUS ==================
    async function renderStatus() {
      content.innerHTML = `
        <div class="card"><div class="inner">
          <div class="section-title">Status abfragen</div>
          <label class="label">Abholcode oder Auftrags-ID</label>
          <input id="s_code" placeholder="z. B. HBS-5482" oninput="filterOrders(this.value)" />
        </div></div>
        <div id="orderList"></div>`;

      let orders = [];
      try {
        if (APPSCRIPT_BASE) {
          const r = await fetch(APPSCRIPT_BASE + '?action=listOrders');
          const d = await r.json();
          if (d.ok) orders = d.items || [];
        } else {
          // Lokale Demo-Daten
          orders = [
            { id: "O-2025-0001", bike: "Cube Trekking, Schwarz", status: "Warten auf Teile", price: 120, pickup: "HBS-5482" },
            { id: "O-2025-0002", bike: "Specialized Stumpjumper", status: "In Arbeit", price: 180, pickup: "HBS-7319" }
          ];
        }
      } catch(e){ /* ignore */ }
      window.__ORDERS__ = orders;
      filterOrders('');
    }

    function filterOrders(code) {
      const wrap = document.getElementById('orderList');
      const list = (window.__ORDERS__||[]).filter(o =>
        (code||'').trim()==='' ||
        (o.pickup||'').toLowerCase().includes(code.toLowerCase()) ||
        (o.id||'').toLowerCase().includes(code.toLowerCase())
      );
      wrap.innerHTML = list.map(o => `
        <div class="card"><div class="inner">
          <span class="badge">${o.pickup||'—'}</span>
          <h3>${o.bike||'—'}</h3>
          <p>Status: <strong>${o.status||'—'}</strong> · Kostenschätzung: €${o.price||'—'}</p>
        </div></div>`).join('');
    }

    // ================== BONUS ==================
    function renderBonus() {
      const loyalty = [ { user: 'Max Beispiel', count: 3 }, { user: 'Anna Muster', count: 7 } ];
      content.innerHTML = loyalty.map((l, i) => `
        <div class="card"><div class="inner">
          <h3>${l.user}</h3>
          <p>Stempel: <strong id="cnt_${i}">${l.count}</strong> / 10</p>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn" onclick="document.getElementById('cnt_${i}').textContent = parseInt(document.getElementById('cnt_${i}').textContent,10)+1">+1 Stempel</button>
            <button class="btn secondary" onclick="document.getElementById('cnt_${i}').textContent = 0">Zurücksetzen</button>
          </div>
        </div></div>`).join('');
    }

    // ================== KONTAKT ==================
    function renderKontakt() {
      const c = DATA.contact;
      content.innerHTML = `
        <div class="card"><div class="inner">
          <div class="section-title">Kontakt</div>
          <p><strong>Adresse:</strong> ${c.address}</p>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin:10px 0 6px;">
            <a class="btn" href="tel:${c.phone}">Anrufen</a>
            <a class="btn secondary" target="_blank" href="${c.whatsapp}">WhatsApp</a>
            <a class="btn" target="_blank" href="${c.maps}">Maps</a>
            <a class="btn secondary" href="mailto:${c.email}">E-Mail</a>
          </div>
          <div class="small">Öffnungszeiten: Mo–Fr 09:00–18:00, Sa 09:00–12:00</div>
        </div></div>`;
    }

    // ================== ADMIN ==================
    let adminOK = false;
    function renderAdmin() {
      if (!adminOK) {
        content.innerHTML = `
          <div class="card"><div class="inner">
            <div class="section-title">Admin Login</div>
            <label class="label">PIN</label><input id="pin" type="password" placeholder="z. B. 1234" />
            <div style="margin-top:12px"><button class="btn" onclick="checkPin()">Login</button></div>
            <div class="small" style="margin-top:8px">Tipp: Ändere die PIN im Code (<code>ADMIN_PIN</code>).</div>
          </div></div>`;
        return;
      }
      content.innerHTML = `
        <div class="card"><div class="inner">
          <div class="section-title">Neuen Auftrag anlegen</div>
          <label class="label">Auftrags-ID</label><input id="o_id" placeholder="z. B. O-2025-0003" />
          <label class="label">Fahrrad</label><input id="o_bike" placeholder="z. B. KTM Macina" />
          <label class="label">Status</label><input id="o_status" placeholder="z. B. In Arbeit" />
          <label class="label">Preis (€)</label><input id="o_price" type="number" placeholder="0" />
          <label class="label">Abholcode</label><input id="o_pickup" placeholder="z. B. HBS-1234" />
          <div style="margin-top:12px"><button class="btn" onclick="createOrder()">Speichern</button></div>
          <div class="small" style="margin-top:8px">Speichert in Google Sheets, wenn <code>APPSCRIPT_BASE</code> gesetzt ist.</div>
        </div></div>`;
    }

    function checkPin(){
      const v = document.getElementById('pin').value;
      if (v === ADMIN_PIN) { adminOK = true; renderAdmin(); }
      else { alert('Falscher PIN'); }
    }

    async function createOrder(){
      const order = {
        id: document.getElementById('o_id').value.trim(),
        bike: document.getElementById('o_bike').value.trim(),
        status: document.getElementById('o_status').value.trim(),
        price: document.getElementById('o_price').value.trim(),
        pickup: document.getElementById('o_pickup').value.trim()
      };
      if (!order.id || !order.bike || !order.status || !order.pickup){ alert('Bitte ID, Bike, Status, Abholcode ausfüllen.'); return; }
      if (!APPSCRIPT_BASE){ alert('Demo: Keine Speicherung (APPSCRIPT_BASE leer).'); return; }
      try {
        const r = await fetch(APPSCRIPT_BASE + '?action=createOrder', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(order)});
        const d = await r.json();
        if (d.ok) { alert('Auftrag gespeichert ✅'); renderStatus(); }
        else { throw new Error(d.error||'Fehler'); }
      } catch(e){ alert('Fehler beim Speichern: ' + e.message); }
    }

    // ================== TABS ==================
    const tabs = document.querySelectorAll('.tab-btn');
    tabs.forEach(btn => btn.addEventListener('click', () => {
      tabs.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.dataset.tab;
      if (tab === 'start') renderStart();
      if (tab === 'termin') renderTermin();
      if (tab === 'status') renderStatus();
      if (tab === 'bonus') renderBonus();
      if (tab === 'kontakt') renderKontakt();
      if (tab === 'admin') renderAdmin();
    }));

    // Initial
    renderStart();
  </script>
</body>
</html>
